define(["jquery","domReady!"],function(a){a.widget("maxServ.yoastSeo",{_create:function(){this.config=window.yoastBoxConfig;if(this.config.hide_yoastbox===true){this.hide()}else{this.setup()}},hide:function(){a('[data-index="search_engine_optimization"]').hide()},setup:function(){var b=this;if(!this.checkInputElements()){setTimeout(function(){b.setup()},300);return}this.element=a("#yoast-seo-wrapper");this.snippetPreviewElement=a("#yoast-seo-snippet-preview")[0];this.getInputElements();a("#yoast-seo-wrapper").tabs({active:0});this.inputElements=[this.titleInputElement,this.focusKeywordInputElement];this.hideInputElements=[this.urlKeyInputElement,this.metaTitleInputElement,this.metaDescriptionInputElement];this.getTemplateElements();this.setupSnippetPreview();this.setupApp();this.updateFieldsets();this.setupEventListeners();this.updateInterval=window.setInterval(function(){this.update()}.bind(this),1000)},getFocusKeywordFieldIdentifier:function(){return this.config.focusKeywordFieldIdentifier||".yoastBox-focusKeyword"},getFocusKeywordIdentifier:function(){return this.config.focusKeywordIdentifier||".yoastBox-focusKeyword .admin__control-text"},getTitleIdentifier:function(){return this.config.titleIdentifier||".yoastBox-title .admin__control-text"},getUrlKeyIdentifier:function(){return this.config.urlKeyIdentifier||".yoastBox-urlKey .admin__control-text"},getMetaTitleIdentifier:function(){return this.config.metaTitleIdentifier||".yoastBox-metaTitle .admin__control-text"},getMetaDescriptionIdentifier:function(){return this.config.metaDescriptionIdentifier||".yoastBox-metaDescription .admin__control-textarea"},getMetaKeywordsIdentifier:function(){return this.config.metaKeywordsIdentifier||".yoastBox-metaKeywords"},checkInputElements:function(){return a(this.getTitleIdentifier()).length&&a(this.getUrlKeyIdentifier()).length&&a(this.getMetaTitleIdentifier()).length&&a(this.getMetaDescriptionIdentifier()).length},getInputElements:function(){this.titleInputElement=a(this.getTitleIdentifier());this.urlKeyInputElement=a(this.getUrlKeyIdentifier());this.metaTitleInputElement=a(this.getMetaTitleIdentifier());this.focusKeywordInputElement=a(this.getFocusKeywordIdentifier());this.metaDescriptionInputElement=a(this.getMetaDescriptionIdentifier())},getTemplateElements:function(){var e=this,c=this.config.contentTemplate,d=c.match(/\{\{([\sa-zA-Z0-9\-_\[\]"=]+)}}/g),b,f;e.templateElements={};a(d).each(function(){if(this!=="{{images}}"){b=this.replace(/(\{\{|}})/g,"");f=a(b);if(f.length){e.templateElements[this]=f;e.inputElements.push(f)}}})},setupSnippetPreview:function(){var b=this;b.snippetPreview=new YoastSEO.SnippetPreview({data:{title:b.getTitleValue(),keyword:b.getKeywordValue(),metaDesc:b.getDescriptionValue(),urlPath:b.getIdentifierValue()},callbacks:{saveSnippetData:function(c){b.saveSnippetData(c)}},baseUrl:b.getBaseUrl(),targetElement:b.snippetPreviewElement})},setupApp:function(){var b=this;this.app=new YoastSEO.App({snippetPreview:b.snippetPreview,contentAnalysisActive:true,targets:{output:"yoast-seo-output",contentOutput:"yoast-seo-content-output"},callbacks:{updateSnippetValues:function(){},getData:function(){return{baseUrl:b.getBaseUrl(),title:b.getTitleValue(),metaTitle:b.getTitleValue(),keyword:b.getKeywordValue(),text:b.getContentValue(),meta:b.getDescriptionValue(),metaDesc:b.getDescriptionValue()}}}});b.app.refresh()},updateFieldsets:function(){a("#yoast-seo-facebook").append(a(".yoastBox-facebook-fieldset"));a("#yoast-seo-twitter").append(a(".yoastBox-twitter-fieldset"));a("#yoast-seo-keywords-fieldset").append(a(this.getMetaKeywordsIdentifier()));a("#yoast-seo-focus-input-fieldset").append(a(this.getFocusKeywordFieldIdentifier()));a(this.hideInputElements).each(function(){a(this).parents(".admin__field").hide()})},update:function(){this.app.refresh();this.snippetPreview.setTitle(this.getTitleValue());this.snippetPreview.setUrlPath(this.getIdentifierValue());this.snippetPreview.setMetaDescription(this.getDescriptionValue())},setupEventListeners:function(){var d=this,b=function(){d.update()},c=this.inputElements.concat([a(".yoastBox-content textarea")]);a(c).each(function(){a(this).on("change",b)})},saveSnippetData:function(b){this.setTitleValue(b.title);this.setDescriptionValue(b.metaDesc);this.setIdentifierValue(b.urlPath)},getBaseUrl:function(){var b=window.location.origin;if(b.substring(b.length-1,1)!=="/"){b+="/"}return b},getTitleValue:function(){var b=this.metaTitleInputElement.val(),c=this.titleInputElement.val();if(b){return b}else{if(c){return c}}return""},setTitleValue:function(b){this.metaTitleInputElement.val(b).change();return this},getIdentifierValue:function(){return this.urlKeyInputElement.val()},setIdentifierValue:function(b){this.urlKeyInputElement.val(b).change();return this},getKeywordValue:function(){return this.focusKeywordInputElement.val()},setKeywordValue:function(b){this.focusKeywordInputElement.val(b).change();return this},getContentValue:function(){var d=this,c=d.config.contentTemplate,b;for(b in d.templateElements){c=c.split(b).join(d.getElementValue(d.templateElements[b]))}c=c.replace("{{images}}",d.getEntityImages());return c},getEntityImages:function(){var b="";switch(this.config.entityType){case"catalog_product":b=this.getProductImages();break;default:b=this.config.images.join("<br />");break}return b},getProductImages:function(){var b=[];a('[data-role="image"]').each(function(h,d){var c=a(d),g=c.find('[name*="file"]').val(),f=c.find('[name*="label"]').val(),e=c.find('[name*="disabled"]').val();if(e=="0"){b.push('<img src="'+g+'" alt="'+f+'" />')}});return b.join("<br /> ")},getElementValue:function(d){var b=d.prop("tagName").toLowerCase(),c="";switch(b){case"input":case"textarea":c=d.val();break;case"select":d.find("option:selected").each(function(){c+=(c!==""?", ":"")+a(this).text()});break}return c},getDescriptionValue:function(){return this.metaDescriptionInputElement.val()},setDescriptionValue:function(b){this.metaDescriptionInputElement.val(b).change();return this}});return a.maxServ.yoastSeo});